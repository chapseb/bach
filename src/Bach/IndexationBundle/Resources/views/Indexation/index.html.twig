{% extends 'BachIndexationBundle:Indexation:main.html.twig' %}

{% block container %}
    <form id="published_documents" class="list" action="{{ path("bach_indexation_deletedocuments") }}" method="POST">
    <fieldset>
        <legend>
            {% trans %}Published documents{% endtrans %}
            <span>
                <a id="empty" href="{{ path("bach_indexation_empty") }}" class="btn btn-delete" title="{% trans %}Remove all published documents{% endtrans %}">{% trans %}Remove all{% endtrans %}</a>
                <a href="{{ path('bach_indexation_homepage') }}" id="refresh" class="btn btn-refresh" title="{% trans %}Refresh list{% endtrans %}">{% trans %}Refresh{% endtrans %}</a>
            </span>
        </legend>

        {% if documents is defined and documents|length > 0 %}
        <table>
            <thead>
                <th>Id</th>
                <th>Identifiant</th>
                <th>Type</th>
                <th>Fichier</th>
                <th>Titre</th>
                <th></th>
            </thead>
            <tfoot>
                <tr>
                    <td colspan="6">
                        <button type="submit" id="delete_documents" class="btn btn-delete" title="{% trans %}Remove selected documents{% endtrans %}">{% trans %}Remove selected{% endtrans %}</button>
                    </td>
                </tr>
            </tfoot>
            <tbody>
                {% for document in documents %}
                <tr>
                    <td>
                        <input type="checkbox" name="documents[]" id="document_{{ document.getId }}" value="{{ document.getExtension }}::{{ document.getId }}"/>
                        <label for="document_{{ document.getId }}">{{ document.getId }}</label>
                    </td>
                    <td>{{ document.getDocId }}</td>
                    <td>{{ document.getExtension }}</td>
                    <td>{{ document.getName }}</td>
                    <td></td>
                    <td></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
            <p>Aucun document n'est actuellement indexé.</p>
        {% endif %}
    </fieldset>
    </form>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    $(document).ready(function(){
        $('#empty').click(function(){
            return confirm('Souhaitez-vous réllement supprimer tous les documents indexés ?\n\nCette action n\'est pas réversible !');
        });

        $('#delete_documents').click(function(){
            var _count = $('#documents :checked').length;
            if ( _count == 0 ) {
                alert('Veuillez sélectionner au moins un document.');
                return false;
            } else {
                if ( _count == 1 ) {
                    return confirm('Souhaitez-vous supprimer le document sélectionné ?');
                } else {
                    return confirm('Souhaitez-vous supprimer les ' + _count + ' documents sélectionnés ?');
                }
            }
        });
    });
{% endblock %}
